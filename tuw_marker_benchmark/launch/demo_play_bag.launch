<launch>

    <arg name="mapfile" default="$(find tuw_marker_benchmark)/map/bag_testmap.json" />

    <!-- ROS bag -->
    <param name="use_sim_time" value="true"/>
    <node pkg="rosbag" type="play" name="player" args="--loop --clock --rate 1.0 /home/privacy/Documents/ros/bags/marker_stripped.bag"/>

    <!-- Marker map server -->
    <node pkg="tuw_marker_server" type="tuw_marker_server.py" name="tuw_marker_server">
        <param name="mapfile" value="$(arg mapfile)" />
        <param name="frame_id" value="/p3dx/odom" />
        <remap from="map" to="/markerMap" />
    </node>

    <!-- Marker dedection -->
    <node name="republish" type="republish" pkg="image_transport" args="compressed in:=/p3dx/camera/image_raw raw out:=/p3dx/camera/image_raw_uncompressed" />

    <node pkg="tuw_aruco" type="aruco_node" name="arMarkerAruco">
        <param name="show_debug_image" value="false"/>

        <param name="marker_size" value="0.10"/>
        <param name="pose_estimation_enabled" value="false"/>
        <param name="publish_markers" value="false"/>
        <param name="publish_fiducials" value="true"/>

        <remap from="image" to="/p3dx/camera/image_raw_uncompressed"/>
        <remap from="camera_info" to="/p3dx/camera/camera_info"/>
        <remap from="markers" to="/markersAruco"/>
        <remap from="fiducials" to="/fiducialsAruco"/>
    </node>

    <node pkg="tuw_marker_pose_estimation" type="pose_estimation_node" name="arPoseEstimation">
        <remap from="fiducials" to="/fiducialsAruco"/>
        <remap from="markers" to="/markerDetection"/>
    </node>

    <!-- Benchmark node -->
    <node pkg="tuw_marker_benchmark" type="data_collector_node.py" name="tuw_marker_benchmark" output="screen">
        <param name="tf_camera" value="p3dx/camera"/>
        <param name="tf_odom" value="p3dx/odom"/>

        <remap from="map" to="/markerMap" />
        <remap from="markerDetection" to="/markerDetection" />
    </node>

    <!-- RViz -->
    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find tuw_marker_benchmark)/rviz/demo_bag_config.rviz" />

</launch>

