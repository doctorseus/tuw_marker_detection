<launch>

  <!-- Camera -->
  <include file="$(find tuw_marker_benchmark)/launch/inc_dummy_camera.launch" />

  <!-- Dummy Robot -->
  <node pkg="tf" type="static_transform_publisher" name="base_link_broadcaster" args="0 0 0 0 0 0 1 odom base_link 100" />
  <node pkg="tf" type="static_transform_publisher" name="camera_mount_bar_broadcaster" args="0 0 0.615 0 0 0 1 base_link camera_mount_bar 100" />
  <node pkg="tf" type="static_transform_publisher" name="checkerboard_broadcaster" args="1.187 -0.146 0 0 0 0 base_link checkerboard_static 100" />
  <node pkg="tf" type="static_transform_publisher" name="camera_broadcaster" args="0.01273110107 -0.00271453602046 0.636257383815 0.570464072788 -0.576383801312 0.412362280278 -0.41510216218 base_link camera 100" />

  <!-- Marker map -->
  <node pkg="tf" type="static_transform_publisher" name="type0_base" args="1.112 0 0 0 0 0 base_link type0_base 100" />

  <node pkg="tf" type="static_transform_publisher" name="box_anchor" args="0 0 0.357 1.17809 0 0 type0_base box_anchor 100" />

  <node pkg="tf" type="static_transform_publisher" name="marker_aruco" args="0 0.06 0.06 -1.57079 0 1.57079 box_anchor marker_aruco 100" />
  <node pkg="tf" type="static_transform_publisher" name="marker_ellipse" args="0 -0.06 0.06 -1.57079 0 1.57079 box_anchor marker_ellipse 100" />
  <node pkg="tf" type="static_transform_publisher" name="marker_dice" args="0 0.06 -0.06 -1.57079 0 1.57079 box_anchor marker_dice 100" />
  <node pkg="tf" type="static_transform_publisher" name="marker_checkerboard" args="0 -0.06 -0.06 -1.57079 0 1.57079 box_anchor marker_checkerboard 100" />

  <node pkg="tuw_marker_benchmark" type="tf_to_marker_map_node.py" name="tf_to_marker_map_node" output="screen">
    <param name="tf_list" value="marker_aruco, marker_ellipse, marker_dice, marker_checkerboard"/>
    <param name="tf_frame_id" value="odom"/>
    <remap from="map" to="/markerMap" />
  </node>

  <!-- ArUco -->
  <node pkg="tuw_aruco" type="aruco_node" name="arMarkerAruco">
    <param name="show_debug_image" value="false"/>

    <param name="marker_size" value="0.10"/>
    <param name="pose_estimation_enabled" value="false"/>
    <param name="publish_markers" value="false"/>
    <param name="publish_fiducials" value="true"/>

    <remap from="image" to="/camera/image_raw"/>
    <remap from="camera_info" to="/camera/camera_info"/>
    <remap from="markers" to="/markersAruco"/>
    <remap from="fiducials" to="/fiducialsAruco"/>
  </node>

  <node pkg="tuw_marker_pose_estimation" type="pose_estimation_node" name="arPoseEstimationAruco">
      <remap from="fiducials" to="/fiducialsAruco"/>
      <remap from="markers" to="/markerDetectionAruco"/>
  </node>

  <!-- Dice -->
  <node pkg="tuw_marker_playground" type="mpg_dice_node" name="mpgDice" output="screen">
    <param name="show_debug_image" value="false"/>
    <param name="marker_dot_displacement" value="0.035"/>
    <param name="publish_fiducials" value="true"/>

    <param name="filter_circularity_enabled" value="true"/>
    <param name="filter_circularity_min" value="0.66"/>
    <param name="filter_circularity_max" value="1.0"/>
    <param name="filter_convexity_enabled" value="true"/>
    <param name="filter_convexity_min" value="0.95"/>
    <param name="filter_convexity_max" value="1.0"/>

    <remap from="image" to="/camera/image_raw"/>
    <remap from="camera_info" to="/camera/camera_info"/>
    <remap from="fiducials" to="/fiducialsDice"/>
  </node>

  <node pkg="tuw_marker_pose_estimation" type="pose_estimation_node" name="arPoseEstimationDice" output="screen">
    <remap from="fiducials" to="/fiducialsDice"/>
    <remap from="markers" to="/markerDetectionDice"/>
  </node>

  <!-- Checkerboard -->
  <!-- launch-prefix="gdb -ex run -\-args" -->
  <node pkg="tuw_checkerboard" type="tuw_checkerboard_node" name="tuw_checkerboard_node" output="screen" >
    <param name="show_camera_image" value="true"/>
    <!--
    <param name="plubish_tf" value="False" />
    <param name="plubish_marker" value="False" />
    <param name="publish_fiducials" value="True" />
    <param name="publish_pose" value="False" />
    -->
    <param name="checkerboard_columns" value="3" />
    <param name="checkerboard_rows" value="3" />
    <param name="checkerboard_square_size" value="0.0275" />
    <param name="checkerboard_min_square_size" value="5" />

    <param name="adaptive_thresh" value="True" />
    <param name="normalize_image" value="True" />
    <param name="filter_quads" value="False" />
    <param name="fast_check" value="True" />

    <remap from="image" to="/camera/image_raw"/>
    <remap from="camera" to="/camera"/>
    <remap from="fiducials" to="/fiducialsCheckerboard"/>
  </node>

  <node pkg="tuw_marker_pose_estimation" type="pose_estimation_node" name="arPoseEstimationCheckerboard" output="screen">
    <remap from="fiducials" to="/fiducialsCheckerboard"/>
    <remap from="markers" to="/markerDetectionCheckerboard"/>
  </node>

  <!-- Ellipses -->
  <node pkg="tuw_ellipses" type="ellipses_node" name="ellipses_node" output="screen" >
    <param name="show_camera_image" value="false"/>
    <param name="debug" value="false"/>

    <param name="circle_diameter" value="0.10" />

    <remap from="image" to="camera/image_raw"/>
    <remap from="camera_info" to="camera/camera_info"/>
    <remap from="fiducials" to="/fiducialsEllipses"/>
  </node>

  <node pkg="tuw_marker_pose_estimation" type="pose_estimation_node" name="arPoseEstimationEllipses" output="screen">
    <remap from="fiducials" to="/fiducialsEllipses"/>
    <remap from="markers" to="/markerDetectionEllipses"/>
  </node>

  <!-- RViz -->
  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find tuw_marker_benchmark)/rviz/demo_dummy_config.rviz" />

</launch>

